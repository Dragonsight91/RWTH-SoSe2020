% general format definition
\documentclass[a4paper, 11pt]{article}
\usepackage[margin=.9in]{geometry}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}

% extra packages
\usepackage{hyperref}
\usepackage{listings}
\usepackage{color}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{microtype}
\usepackage{stmaryrd}
\usepackage{tikz}
\usepackage{booktabs}
\usepackage{stmaryrd}
\usepackage{enumitem}

% special math symbols
\newcommand{\R}{\ensuremath{\mathbb{R}}}
\newcommand{\N}{\ensuremath{\mathbb{N}}}
\newcommand{\Z}{\ensuremath{\mathbb{Z}}}
\newcommand{\Q}{\ensuremath{\mathbb{Q}}}

% Fraktur fÃ¼r Strukturen
\newcommand{\A}{\ensuremath{\mathfrak A}}
\newcommand{\B}{\ensuremath{\mathfrak B}}
\newcommand{\C}{\ensuremath{\mathfrak C}}
\newcommand{\I}{\ensuremath{\mathfrak I}}

% logical operators
\newcommand{\xor}{\ensuremath{\oplus}} %exklusives oder
\newcommand{\impl}{\ensuremath{\rightarrow}} %logische Implikation

% nicer symbols
\renewcommand{\phi}{\varphi}
\renewcommand{\theta}{\vartheta}
\renewcommand{\epsilon}{\varepsilon}

% Syntax highlighting
\definecolor{commentsColor}{rgb}{0.497495, 0.497587, 0.497464}
\definecolor{keywordsColor}{rgb}{0.000000, 0.000000, 0.635294}
\definecolor{stringColor}{rgb}{0.558215, 0.000000, 0.135316}
\definecolor{brightlavender}{rgb}{0.75, 0.58, 0.89}
\definecolor{brilliantrose}{rgb}{1.0, 0.33, 0.64}
\definecolor{canaryyellow}{rgb}{1.0, 0.94, 0.0}
\definecolor{cyan}{rgb}{0.0, 1.0, 1.0}
\definecolor{fulvous}{rgb}{0.86, 0.52, 0.0}
\definecolor{olive}{rgb}{0.5, 0.5, 0.0}
\lstset{
  backgroundcolor=\color{white},                        % choose the background color; you must add \usepackage{color} or \usepackage{xcolor}
  basicstyle=\footnotesize,                             % the size of the fonts that are used for the code
  breakatwhitespace=false,                              % sets if automatic breaks should only happen at whitespace
  breaklines=true,                                      % sets automatic line breaking
  captionpos=b,                                         % sets the caption-position to bottom
  commentstyle=\color{commentsColor}\textit,            % comment style
  deletekeywords={},                                    % if you want to delete keywords from the given language
  escapeinside={\%*}{*)},                               % if you want to add LaTeX within your code
  extendedchars=true,                                   % lets you use non-ASCII characters; for 8-bits encodings only, does not work with UTF-8
  frame=tb,	                   	                        % adds a frame around the code
  keepspaces=true,                                      % keeps spaces in text, useful for keeping indentation of code (possibly needs columns=flexible)
  keywordstyle=\color{keywordsColor}\bfseries,          % keyword style
  otherkeywords={True,False,true,false,null,None,NULL}, % if you want to add more keywords to the set
  numbers=left,                                         % where to put the line-numbers; possible values are (none, left, right)
  numbersep=5pt,                                        % how far the line-numbers are from the code
  numberstyle=\tiny\color{commentsColor},               % the style that is used for the line-numbers
  rulecolor=\color{black},                              % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. comments (green here))
  showspaces=false,                                     % show spaces everywhere adding particular underscores; it overrides 'showstringspaces'
  showstringspaces=false,                               % underline spaces within strings only
  showtabs=false,                                       % show tabs within strings adding particular underscores
  stepnumber=1,                                         % the step between two line-numbers. If it's 1, each line will be numbered
  stringstyle=\color{stringColor},                      % string literal style
  tabsize=2,	                                          % sets default tabsize to 2 spaces
  title=\lstname,                                       % show the filename of files included with \lstinputlisting; also try caption instead of title
  columns=fixed,                                        % Using fixed column width (for e.g. nice alignment)
}

\author{Thilo Metzlaff\\406247 \and Mats Frenk\\393702\and Emma van Emelen\\406008}
\title{BUS Exercise 5 \\ Group 23}
\begin{document}
    % titlepage
    \maketitle
    \newpage

    % contents
    \tableofcontents
    \newpage

    % section 0
    \section*{Introduction}
    Welcome back for another Excercise, with me writing every single thing in \LaTeX{}. I am happy to announce, that i have finally found the period that we were looking for.
    I have also fired that unpaid intern that deleted all our data last time. It is currently 3.43 AM and i have procrastinated way too much... this seems to be my deserved punishment.
    I must do this, for i have an obligation to do bullshit. There may be fewer jokes... i also made code examples on github\footnote{\url{https://github.com/Dragonsight91/Study-Courses-Note-collection/tree/master/BUS/exercises/5}}, even for the pseudocode stuff
    (i did it in C... i don't like pseudocode), if you want, you can look at that if i remember to push before dying from sleep deprivation...\\
    Welp, i am finally done, i can now die in pieces. Fun fact: i haven't watched a single one of the lectures. man pages, google and persistence. Takes less time than one might think. 

    

    \subsection*{THE FORMAT}
    \begin{itemize}
      \item Every file will be named similar to the sections in here, so\\
      \texttt{2.1-stack\_exercise.c} is Exercise 2, section 1.
      \item Every Solution \textbf{WILL} be in this pdf, but not necessarily 
            anything predefined by the exercise.
      \item Any explanation will be both in this PDF as well as in each file.
      \item This explanation will be in each PDF, in case someone who doesn't
            know the format tries to correct the exercises
      \item \textbf{WARNING:} Humor may or may not be used. If you are allergic
            to humor, that sounds like a personal problem.
      \item \textbf{WARNING:} Backing up your data is important. Although linux 
            doesn't have the necessary shame to remove itself, unlike windows,
            please do back up your data. And try to keep track of your periods\dots
            they seem to be notoriously hard to find
    \end{itemize}
    \newpage
    \section{Senpai Notice me}
    That solution will not work. Why? Simple: One reporter signals twice.
    This is like your parent telling you to do a thing, after they just told you, while you scheduled it. 
    Suddenly you have to process another signal JUST to find out it's the same thing. 
    In this case, it will just make one guy emulate another guy. Kinda weird... but it ain't gay because one said nohomo\footnote{SPOILER: it's still gay\dots}.\\
    How do we fix it?\\
    Remove one signal. That's it. Code should work now. Go and be free now, you deserve it.
    
    \section{I like trains}
    \subsection{queues before sephora}
    If you want a simple and boring answer, just look at the code below. if you want a working example in C i have an inofficial thing for you in the github repo mentioned earlier, but i digress. 
    To solve this, we need a list, which we have. then we need two counting semaphores. one to prevent deletion, one to prevent adding.
    Now we crosswire them, just like the royals used to do it, and we get THIS:
    \begin{lstlisting}[language=c]
int MAX_LEN = 10; the maximum length of the list
sem_init(enqu, MAX_LEN) // initialize the insert blocking semaphore
sem_init(dequ, 0)       // initialize the remove blocking semaphore
sem_init(sync, 1)       // a synchronizer mutex

void enqueue(element){
      sem_wait(enqu); // can we insert AT ALL? if no, wait here

      sem_wait(sync); // is someone using my toys? let's just... let them play.. we can always clean up later
      queue.add(element); // add our element
      sem_post(sync); // unlock write access again

      sem_post(dequ); // grant UNLIMITED POWAH
}

element dequeue() {
      sem_wait(dequ); // can we dequeue?

      sem_wait(sync); // I HAVE THE HIGH GROUND
      element out = queue.pop();
      sem_post(sync) // DON'T UNDERESTIMATE MY POWER

      sem_post(enqu); // AGATHE BAUAH
}
    \end{lstlisting}
    \newpage
    
    \subsection{Escort(ing) services}

    \begin{enumerate}
          \item Processes are executed ASYRONONCHUSLY\footnote{fun adventures in human multithreading} Meaning that we have a read/write asynchonicity problem here.
                Two guy tryna get the same girl but she just take's 'em both. Nothing wrong with that, but somehow neither of the guys know, and have the same outdated status.
                In our case, we don't get busy. Let's say we have two cars that arrive at the same time. both will skip the busy loop and suddenly we have two cars on the platform.
                Now, i don't know about you, but i haven't seen anyone stack cars recenmtly.
          \item Another R/W asynchronicity problem. One car arrives but an amount of $n$ visitors arrives. all have a chance to skip the busy loop due to outdated information and suddenly we have an amount of $n$ visitors in $2$ seats.
                I've seen clowns do that, they seem to be able to stack efficiently... but for anyone else, this tends to be a problem.
    \end{enumerate}
    \subsection{Need for Seat}
    \begin{lstlisting}[language=c]
sem_init(carQueue,1);  //Mutex to show if platform is available. 
sem_init(passQueue,0); //Counter Semaphore for the passenger queue
sem_init(seatAvail,0); //Counter Semaphore to check seat avalability. no seat = no car

void AnkunftWagen(){

      // wait for the platform to be available. Just how we do with shoes.
      wait(carQueue);

      fahreAufPlattform();
      oeffneTueren();

      // promise a "real bunny"
      sem_post(seatAvail);
      sem_post(seatAvail);

      // wait for victims to get in van
      sem_wait(passQueue);
      sem_wait(passQueue);

      schliesseTueren();
      verlassePlattform();

      // let ne
      sem_post(carQueue);
}

void AnkunftBesucher(){
      sem_wait(seatAvail); // wait for seats to be available. no seat = no car
      betreteWagen();
      sem_post(passQueue); // let the driver know you're inside
}
    \end{lstlisting}
    \newpage

    \subsection{Pascha 7th Floor}
    We can add another semaphore that counts VIPs. If there's someone in there, we prioritize them.
    If there aren't enough VIP, we fill the rest with peasants.
    it can be done like this:
    \begin{itemize}
          \item get value of VIP semaphore
          \item if >0, we add $n$ VIP to the car. then we we fill up with $2-n$ peasants.
          \item otherwise we add 2 peasants.
    \end{itemize}
    \section{Eating out. waiiiit a minute...}
    Since all explanations are in the comments, i will keep it short.
    \begin{enumerate}
          \item we need to add a synchronization mutex. only one person can write at a time.
          \item since shared memory is being deregistered and properly marked for destruction, there's no need to care for that.
          \item i wanted to implement zombie process handling, but i didn't. Daddy does not know about the death of his children.
          \item we sync every time we read or write to/from shared memory. otherwise we get a gangbang problem (many try to access one resource. can work, can go wrong).
          \item i only use an 8-bit integer for the waiter's run flag, because i only need 1 or 0.
          \item \texttt{masks} is a zero initialized semaphore. No one has a mask.
          \item \texttt{insert\_unnecessarily\_long\_free\_space\_variable\_name}\footnote{\texttt{free\_space\_inside}, could be shortened to fSpace} is initialized to \texttt{MAX\_CUSTOMERS} it holds the amount of free space
          \item It is now \texttt{5.15AM} sleep is overrated, i'm a programmer.
          \item the waiter only gives anyone a mask, if there are enough people in the queue. otherwise we randomly give masks to no one, which sometimes creates weird problems.
          \item Customers are first invited to the restaurant and only then do they wait to get a mask. suboptimal, but masks can be available, as long as there are people in the queue.
          \item i don't know why, but i decided to just do te most annoying thing and put an lstlisting with all the code on the next.. few pages.... it's the exact same thing as the code file.
    \end{enumerate}
    \newpage
    \lstinputlisting[language=c]{3-eating_out.c}
    
\end{document}